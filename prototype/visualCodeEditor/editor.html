<!doctype html>
<html>
<head>
  <link href="editor.css" rel="stylesheet">
</head>
<body>

<div class="editor" data-bind="template: { name: 'module-template', data: module }" unselectable="on" onselectstart="return false;"></div>

<script type="text/html" id="module-template">
    <div class="module expression">
        <div class="name" data-bind="text: name"></div>
        <div class="expressions">
            <!-- ko foreach: expressions -->
                <!-- ko template: { name: 'drop-template', data: { mode: 'horizontal', type: 'expression', position: $index }} --><!-- /ko -->
                <!-- ko template: { name: template } --><!-- /ko -->
            <!-- /ko -->
            <!-- ko template: { name: 'drop-template', data: { mode: 'horizontal', type: 'expression', position: expressions().length }} --><!-- /ko -->
        </div>
    </div>
</script>

<script type="text/html" id="assignment-template">
    <div class="assignment expression" data-bind="with: assignment">
        <div class="lvalue" data-bind="template: { name: lvalue.template, data: lvalue }"></div>
        <div class="op" data-bind="text: op"></div>
        <div class="rvalue" data-bind="template: { name: rvalue.template, data: rvalue }, style: { display: rvalue.template() === 'function-template' ? 'block' : 'inline-block' }"></div>
    </div>
</script>

<script type="text/html" id="var-template">
    <div class="var expression" data-bind="with: $data['var']">
        <div class="keyword">var</div>
        <!-- ko if: name -->
            <div class="symbol draggable" data-bind="text: name" data-drop-target-types="['expression', 'function-name', 'symbol-missing', 'defarg', 'callarg']"></div>
        <!-- /ko -->
        <!-- ko ifnot: name -->
            <!-- ko template: { name: 'drop-template', data: { mode: 'outline', type: 'symbol-missing' }} --><!-- /ko -->
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="ref-template">
    <div class="ref expression" data-bind="with: ref">
        <div class="symbol draggable" data-drop-target-types="['expression', 'function-name', 'symbol-missing', 'defarg', 'callarg']">
            <span data-bind="text: name"></span>
            <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callable' }} --><!-- /ko -->
        </div>
    </div>
    <!-- ko template: { name: 'expression-operator-template', data: ref } --><!-- /ko -->
</script>

<script type="text/html" id="expression-operator-template">
    <!-- ko if: $data['call'] -->
        <!-- ko template: { name: 'call-template', data: $data['call'] } --><!-- /ko -->
    <!-- /ko -->
    <!-- ko if: $data.sub -->
        <!-- ko template: { name: 'sub-template', data: $data.sub } --><!-- /ko -->
    <!-- /ko -->
    <!-- ko if: $data.prop -->
        <!-- ko template: { name: 'prop-template', data: prop } --><!-- /ko -->
    <!-- /ko -->
</script>

<script type="text/html" id="call-template">
    <div class="call">
        <div class="args">
            <div class="expressions">
                <!-- ko foreach: args -->
                    <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callarg', position: $index }} --><!-- /ko -->
                    <!-- ko template: { name: template } --><!-- /ko -->
                <!-- /ko -->
                <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callarg', position: args().length }} --><!-- /ko -->
            </div>
            <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callable' }} --><!-- /ko -->
        </div>
    </div>
    <!-- ko template: { name: 'expression-operator-template' } --><!-- /ko -->
</script>

<script type="text/html" id="sub-template">
    <div class="sub">
        <!-- ko template: { name: template } --><!-- /ko -->
        <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callable' }} --><!-- /ko -->
    </div>
    <!-- ko template: { name: 'expression-operator-template' } --><!-- /ko -->
</script>

<script type="text/html" id="prop-template">
    <div class="prop">
        <div class="op">.</div>
        <!-- ko template: { name: template } --><!-- /ko -->
    </div>
</script>

<script type="text/html" id="literal-template">
    <div class="literal draggable expression" data-bind="with: literal" data-drop-target-types="['expression','callarg']">
        <!-- ko if: value === '' -->
            <div data-bind="css: { class: type }">&nbsp;</div>
        <!-- /ko -->
        <!-- ko if: value !== '' -->
            <div data-bind="css: { class: type }, html: value"></div>
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="if-template">
    <div class="if expression" data-bind="with: $data['if']">
        <div class="keyword">if</div>
        <!-- ko template: { name: condition.template, data: condition } --><!-- /ko -->
        <div class="then" data-bind="template: { name: $data['then'].template, data: $data['then'] }"></div>
        <!-- ko if: $data['else'] -->
            <div>
                <div class="keyword">else</div>
                <div class="else" data-bind="template: { name: $data['else'].template, data: $data['else'] }">
                </div>
            </div>
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="binary-template">
    <div class="binary expression" data-bind="with: binary">
        <div class="left" data-bind="template: { name: left.template, data: left }"></div>
        <div class="op" data-bind="text: op"></div>
        <div class="right" data-bind="template: { name: right.template, data: right }"></div>
    </div>
</script>

<script type="text/html" id="ternary-template">
    <div class="ternary expression" data-bind="with: ternary">
        <!-- ko template: { name: $data['if'].template, data: $data['if'] } --><!-- /ko -->
        <span class="then op">?</span>
        <!-- ko template: { name: $data['then'].template, data: $data['then'] } --><!-- /ko -->
        <span class="else op">:</span>
        <!-- ko template: { name: $data['else'].template, data: $data['else'] } --><!-- /ko -->
    </div>
</script>

<script type="text/html" id="parens-template">
    <div class="parens expression" data-bind="template: { name: parens.template, data: parens }">
    </div>
</script>

<script type="text/html" id="hash-template">
    <div class="hash expression" data-bind="foreach: hash.entries">
        <div class="entry">
            <div class="key" data-bind="text: key"></div>
            <span class="op">:</span>
            <!-- ko template: { name: value.template, data: value } --><!-- /ko -->
        </div>
    </div>
</script>

<script type="text/html" id="function-template">
    <div class="function expression" data-bind="with: $data['function']">
        <div class="keyword">function</div>
        <div class="collapse expanded"></div>
        <!-- ko if: name -->
            <div class="symbol draggable" data-bind="text: name" data-drop-target-types="['expression', 'function-name', 'symbol-missing', 'defarg', 'callarg']"></div>
        <!-- /ko -->
        <!-- ko ifnot: name -->
            <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'function-name' }} --><!-- /ko -->
        <!-- /ko -->
        <div class="args">
            <!-- ko foreach: args -->
                <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'defarg', position: $index }} --><!-- /ko -->
                <div class="symbol draggable" data-bind="text: $data" data-drop-target-types="['expression', 'function-name', 'symbol-missing', 'defarg', 'callarg']"></div>
            <!-- /ko -->
            <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'defarg', position: args().length }} --><!-- /ko -->
        </div>
        <div class="collapsible expanded expressions">
            <!-- ko foreach: expressions -->
                <!-- ko template: { name: 'drop-template', data: { mode: 'horizontal', type: 'expression', position: $index }} --><!-- /ko -->
                <!-- ko template: { name: template } --><!-- /ko -->
            <!-- /ko -->
            <!-- ko template: { name: 'drop-template', data: { mode: 'horizontal', type: 'expression', position: expressions().length }} --><!-- /ko -->
        </div>
    </div>
</script>

<script type="text/html" id="return-template">
    <div class="return expression" data-bind="with: $data['return']">
        <div class="keyword">return</div>
        <!-- ko template: { name: template } --><!-- /ko -->
    </div>
</script>

<script type="text/html" id="new-template">
    <div class="new expression" data-bind="with: $data['new']">
        <div class="keyword">new</div>
        <div class="symbol draggable" data-drop-target-types="['expression', 'function-name', 'symbol-missing', 'defarg', 'callarg']">
            <span data-bind="text: name"></span>
            <!-- ko template: { name: 'drop-template', data: { mode: 'vertical', type: 'callable' }} --><!-- /ko -->
        </div>
        <!-- ko template: { name: 'expression-operator-template' } --><!-- /ko -->
    </div>
</script>

<script type="text/html" id="drop-template">
    <div class="droppable" data-bind="css: mode, attr: { 'data-drop-type': type, 'data-drop-position': $data.position }"></div>
</script>

<div class="palette-container" unselectable='on' onselectstart='return false;'>
  <div class="palette" unselectable='on' onselectstart='return false;'>
    <div class="mode">mov</div>
    <div class="draggable new-function" data-expression-type="function" data-drop-target-types='["expression", "callarg"]'>func</div>
    <div class="draggable new-keyword" data-expression-type="var" data-drop-target-types='["expression"]'>var</div>
    <div class="draggable new-symbol" data-expression-type="ref" data-drop-target-types='["expression", "func", "symbol-missing", "defarg", "callarg"]'>sym</div>
    <div class="draggable new-call" data-expression-type="call" data-drop-target-types='["callable"]' data-drop-reparent>(call)</div>
    <div class="draggable new-literal" data-expression-type="literal" data-drop-target-types='["expression", "callarg"]'>lit</div>
    <div class="draggable new-assignment">=</div>
    <div class="draggable new-operator">op</div>
    <div class="draggable new-parens">( )</div>
    <div class="draggable new-brackets">[ ]</div>
    <div class="draggable new-hash">{ }</div>
    <div class="draggable new-entry">:</div>
  </div>
</div>

<script src="lib/jquery-2.1.0.min.js"></script>
<script src="lib/jquery-ui-1.10.4.custom.min.js"></script>
<script src="lib/jquery.ui.touch-punch.min.js"></script>
<script src="lib/jquery.ui.touch-closest-to-cursor-punch.js"></script>
<script src="lib/lodash.min.js"></script>
<script src="lib/knockout-3.0.0.debug.js"></script>
<script src="lib/knockout.mapping-latest.js"></script>
<script src="editor.js"></script>
</body>
</html>